CREATE TABLE gold.dim_customers(
	customer_key int,
	customer_id int,
	customer_number varchar(50),
	first_name varchar(50),
	last_name varchar(50),
	country varchar(50),
	marital_status varchar(50),
	gender varchar(50),
	birthdate date,
	create_date date
);
CREATE TABLE gold.dim_products(
	product_key int ,
	product_id int ,
	product_number varchar(50) ,
	product_name varchar(50) ,
	category_id varchar(50) ,
	category varchar(50) ,
	subcategory varchar(50) ,
	maintenance varchar(50) ,
	cost int,
	product_line varchar(50),
	start_date date 
);


CREATE TABLE gold.fact_sales(
	order_number varchar(50),
	product_key int,
	customer_key int,
	order_date date,
	shipping_date date,
	due_date date,
	sales_amount int,
	quantity int,
	price int 
);


--Explore all objects in the database

SELECT*
FROM INFORMATION_SCHEMA.TABLES;


--Explore all columns in the database

SELECT *
FROM INFORMATION_SCHEMA.COLUMNS;

--What all countries do our customers come from?

SELECT DISTINCT country
FROM gold.dim_customers;

--What are the products being offered along with their categories?

SELECT DISTINCT product_name,category,subcategory
FROM gold.dim_products
WHERE category IS NOT NULL;


--Find the date of the first and last order?
--How many years of sales data is available?

SELECT
MIN(order_date)AS first_order_date,
MAX(order_date) AS last_order_date,
DATE_PART('year',MAX(order_date))-DATE_PART('year',MIN(order_date)) AS order_range_years
FROM gold.fact_sales;


--Finds the youngest and oldest customers?

SELECT
DATE_PART('year',AGE(CURRENT_DATE,MAX(birthdate))) AS youngest_customer_age,
DATE_PART('year',AGE(CURRENT_DATE,MIN(birthdate))) AS oldest_customer_age
FROM gold.dim_customers;


--Find the total sales?

SELECT SUM(sales_amount) AS total_sales
FROM gold.fact_sales;


--Find how many items are sold?

SELECT SUM(quantity) AS total_items_sold
FROM gold.fact_sales;


--Find the average selling price?

SELECT ROUND(AVG(price),2) AS avg_selling_price
FROM gold.fact_sales;


--Find the total number of orders?

SELECT COUNT(DISTINCT order_number) AS total_orders
FROM gold.fact_sales;


--Find the total numbers of products?

SELECT COUNT(product_key) AS total_products
FROM gold.dim_products;


--Find the total number of customers?

SELECT COUNT(customer_key) AS total_customers
FROM gold.dim_customers;


--Find the total number of customers that have placed orders?

SELECT COUNT(DISTINCT customer_key) AS total_customers
FROM gold.fact_sales;


--Generate a report with all the key metrics

SELECT 'Total Sales' AS measure_name, SUM(sales_amount) AS measure_value  FROM gold.fact_sales
UNION ALL
SELECT 'Total Items Sold' AS measure_name,SUM(quantity) AS measure_value FROM gold.fact_sales
UNION ALL
SELECT 'Average Selling Price' AS measure_name,ROUND(AVG(price),2) AS measure_value FROM gold.fact_sales
UNION ALL
SELECT 'Total Orders' AS measure_name,COUNT(DISTINCT order_number) AS measure_value FROM gold.fact_sales
UNION ALL
SELECT 'Total Products' AS measure_name,COUNT(product_key) AS measure_value FROM gold.dim_products
UNION ALL
SELECT 'Total Customers' AS measure_name, COUNT(customer_key) AS measure_value FROM gold.dim_customers
UNION ALL
SELECT 'Total Customers Who Ordered' AS measure_name,COUNT(DISTINCT customer_key) AS measure_value FROM gold.fact_sales;


--Find total customers by countries.

SELECT country,COUNT(customer_key) AS total_customers
FROM gold.dim_customers
GROUP BY country;


--Find total customers by gender.

SELECT gender, COUNT(customer_key) AS total_customers
FROM gold.dim_customers
GROUP BY gender;


--Find total products by category.

SELECT category,COUNT(product_key) AS total_products
FROM gold.dim_products
GROUP BY category;


--What is the average cost in each category from highest to lowest?

SELECT category,ROUND(AVG(cost),2) AS average_cost
FROM gold.dim_products
GROUP BY category
ORDER BY average_cost DESC;


--What is the total revenue generated for each category?

SELECT p.category,SUM(f.sales_amount) AS total_revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_products p
ON f.product_key=p.product_key
GROUP BY p.category;


--What is the total revenue generated for each customer?

SELECT c.customer_key, c.first_name,c.last_name,SUM(f.sales_amount) AS total_revenue 
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON f.customer_key=c.customer_key
GROUP BY c.customer_key, c.first_name,c.last_name;


--What is the distribution of sold items across countries?

SELECT c.country,SUM(f.quantity) AS total_items_sold
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON f.customer_key=c.customer_key
GROUP BY c.country;


--Which 5 products generate the highest revenue?

SELECT p.product_name,SUM(f.sales_amount) AS total_revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_products p
ON f.product_key=p.product_key
GROUP BY p.product_name
ORDER BY total_revenue DESC
LIMIT 5;


--What are the 5 worst performing products in terms of sales?

SELECT p.product_name,SUM(f.quantity) AS total_sales
FROM gold.fact_sales f
LEFT JOIN gold.dim_products p
ON f.product_key=p.product_key
GROUP BY p.product_name
ORDER BY total_sales ASC;
LIMIT 5
